<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.hzero.service.infra.mapper.SaleOrderMapper">
    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap id="BaseResultMap" type="org.hzero.service.domain.entity.SaleOrder">
        <result column="sale_order_id" property="saleOrderId" jdbcType="DECIMAL"/>
        <result column="sale_order_number" property="saleOrderNumber" jdbcType="VARCHAR"/>
        <result column="sale_id" property="saleId" jdbcType="DECIMAL"/>
        <result column="company_id" property="companyId" jdbcType="DECIMAL"/>
        <result column="client_id" property="clientId" jdbcType="DECIMAL"/>
        <result column="sale_address" property="saleAddress" jdbcType="VARCHAR"/>
        <result column="store_id" property="storeId" jdbcType="DECIMAL"/>
        <result column="sale_order_state" property="saleOrderState" jdbcType="DECIMAL"/>
        <result column="sale_order_date" property="saleOrderDate" jdbcType="DATE"/>
        <result column="currency" property="currency" jdbcType="DECIMAL"/>
        <result column="sale_order_sum_price" property="saleOrderSumPrice" jdbcType="DECIMAL"/>
        <result column="organization_id" property="organizationId" jdbcType="DECIMAL"/>
        <result column="created_by" property="createdBy" jdbcType="DECIMAL"/>
        <result column="creation_date" property="creationDate" jdbcType="DATE"/>
        <result column="last_updated_by" property="lastUpdatedBy" jdbcType="DECIMAL"/>
        <result column="last_update_date" property="lastUpdateDate" jdbcType="DATE"/>
        <result column="object_version_number" property="objectVersionNumber" jdbcType="DECIMAL"/>
    </resultMap>

    <!--    查询销售订单分页-->
    <select id="getSaleOrderPage" resultType="org.hzero.service.domain.entity.SaleOrder">
        SELECT
        sale_order.sale_order_id,
        sale_order.sale_order_number,
        sale_order.company_id,
        sale_order.sale_order_date,
        sale_order.sale_id,
        sale_order.currency,
        sale_order.sale_order_sum_price,
        sale_order.sale_order_state,
        sale_order.client_id
        FROM
        `hff_sale_order` sale_order
        WHERE
        sale_order.organization_id = #{tenantId}
        <if test="null != keyword">
            AND sal_order.sale_order_number LIKE CONCAT('%',#{keyword},'%')
        </if>

        <if test="null != saleOrder.saleOrderNumber and '' != saleOrder.saleOrderNumber">
            AND sal_order.sale_order_number LIKE CONCAT('%',#{saleOrder.saleOrderNumber},'%')
        </if>

        <if test="null != saleOrder.companyId">
            AND sal_order.company_id = #{saleOrder.companyId}
        </if>
        <if test="null != saleOrder.clientId">
            AND sale_order.client_id = #{saleOrder.clientId}
        </if>

        <if test="null != saleOrder.saleOrderState">
            AND sale_order.sale_order_state = #{saleOrder.saleOrderState}
        </if>

        <if test="null != startDate and null != endDate">
            AND sal_order.sale_order_date BETWEEN #{startDate} AND #{endDate}
        </if>
        <if test="null != startDate and null == endDate">
            AND TIMESTAMPDIFF(
            DAY,
            #{startDate},
            sal_order.sale_order_date
            ) >= 0
        </if>
        <if test="null == startDate and null != endDate">
            AND TIMESTAMPDIFF(
            DAY,
            sal_order.sale_order_date,
            #{endDate}
            ) >= 0
        </if>
    </select>

    <!--    根据id查询销售订单-->
    <select id="getSaleOrderByOrderId" resultType="org.hzero.service.domain.entity.SaleOrder">
        SELECT sale_order.sale_order_id,
               sale_order.store_id,
               sale_order.sale_order_number,
               sale_order.company_id,
               sale_order.sale_order_date,
               sale_order.sale_address,
               sale_order.sale_id,
               sale_order.currency,
               sale_order.sale_order_sum_price,
               sale_order.sale_order_state,
               sale_order.client_id
        FROM `hff_sale_order` sale_order
        WHERE sale_order.organization_id = #{tenantId}
          AND sale_order.sale_order_id = #{saleOrderId}
    </select>

</mapper>