<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.hzero.service.infra.mapper.PurchaseOrderMapper">
    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap id="BaseResultMap" type="org.hzero.service.domain.entity.PurchaseOrder">
        <result column="purchase_order_id" property="purchaseOrderId" jdbcType="DECIMAL"/>
        <result column="purchase_order_number" property="purchaseOrderNumber" jdbcType="VARCHAR"/>
        <result column="supplier_id" property="supplierId" jdbcType="DECIMAL"/>
        <result column="store_id" property="storeId" jdbcType="DECIMAL"/>
        <result column="store_address" property="storeAddress" jdbcType="VARCHAR"/>
        <result column="purchase_id" property="purchaseId" jdbcType="DECIMAL"/>
        <result column="currency_id" property="currencyId" jdbcType="DECIMAL"/>
        <result column="organization_id" property="organizationId" jdbcType="DECIMAL"/>
        <result column="purchase_order_sum_price" property="purchaseOrderSumPrice" jdbcType="DECIMAL"/>
        <result column="purchase_order_state" property="purchaseOrderState" jdbcType="DECIMAL"/>
        <result column="purchase_order_date" property="purchaseOrderDate" jdbcType="DATE"/>
        <result column="created_by" property="createdBy" jdbcType="DECIMAL"/>
        <result column="creation_date" property="creationDate" jdbcType="DATE"/>
        <result column="last_updated_by" property="lastUpdatedBy" jdbcType="DECIMAL"/>
        <result column="last_update_date" property="lastUpdateDate" jdbcType="DATE"/>
        <result column="object_version_number" property="objectVersionNumber" jdbcType="DECIMAL"/>
    </resultMap>

    <resultMap id="OrderDetailResultMap" type="org.hzero.service.domain.entity.PurchaseOrder" extends="BaseResultMap">
        <collection property="children" ofType="org.hzero.service.domain.entity.PurchaseInfo">
            <result column="purchase_info_id" property="purchaseInfoId" jdbcType="DECIMAL"/>
            <result column="purchase_line_number" property="purchaseLineNumber" jdbcType="DECIMAL"/>
            <result column="purchase_order_id" property="purchaseOrderId" jdbcType="DECIMAL"/>
            <result column="material_id" property="materialId" jdbcType="DECIMAL"/>
            <result column="purchase_number" property="purchaseNumber" jdbcType="DECIMAL"/>
            <result column="purchase_info_sum_price" property="purchaseInfoSumPrice" jdbcType="DECIMAL"/>
            <result column="storage_state" property="storageState" jdbcType="DECIMAL"/>
            <result column="purchase_info_remark" property="purchaseInfoRemark" jdbcType="VARCHAR"/>
        </collection>
    </resultMap>


<!--    待删除-->
<!--    <select id="getDetailsByOrderId" resultMap="OrderDetailResultMap">-->
<!--        SELECT-->
<!--            pur_order.purchase_order_id,-->
<!--            pur_order.purchase_order_number,-->
<!--            pur_order.supplier_id,-->
<!--            pur_order.purchase_order_date,-->
<!--            pur_order.store_id,-->
<!--            pur_order.purchase_id,-->
<!--            pur_order.currency_id,-->
<!--            pur_order.purchase_order_sum_price,-->
<!--            pur_order.purchase_order_state,-->
<!--            pur_info.purchase_info_id,-->
<!--            pur_info.purchase_line_number,-->
<!--            pur_info.material_id,-->
<!--            pur_info.purchase_number,-->
<!--            pur_info.purchase_info_sum_price,-->
<!--            pur_info.storage_state,-->
<!--            pur_info.purchase_info_remark-->
<!--        FROM-->
<!--            `hff_purchase_order` pur_order,-->
<!--            `hff_purchase_info` pur_info-->
<!--        WHERE-->
<!--            pur_order.organization_id = #{tenantId}-->
<!--        AND pur_order.purchase_order_id = #{purchaseOrderId}-->
<!--        AND pur_order.purchase_order_id = pur_info.purchase_order_id-->
<!--        ORDER BY-->
<!--            pur_info.purchase_line_number-->
<!--    </select>-->

<!--    查询采购订单分页-->
    <select id="getPurchaseOrderPage" resultType="org.hzero.service.domain.entity.PurchaseOrder">
        SELECT
            pur_order.purchase_order_id,
            pur_order.purchase_order_number,
            pur_order.supplier_id,
            pur_order.purchase_order_date,
            pur_order.purchase_id,
            pur_order.currency_id,
            pur_order.purchase_order_sum_price,
            pur_order.purchase_order_state
        FROM
            `hff_purchase_order` pur_order
        WHERE
            pur_order.organization_id = #{tenantId}
        <if test="null != purchaseOrder.purchaseOrderNumber and '' != purchaseOrder.purchaseOrderNumber">
            AND pur_order.purchase_order_number = #{purchaseOrder.purchaseOrderNumber}
        </if>
        <if test="null != purchaseOrder.supplierId">
            AND pur_order.supplier_id = #{purchaseOrder.supplierId}
        </if>
        <if test="null != purchaseOrder.purchaseOrderState">
            AND pur_order.purchase_order_state = #{purchaseOrder.purchaseOrderState}
        </if>
        <if test="null != startDate and null != endDate">
            AND pur_order.purchase_order_date BETWEEN #{startDate} AND #{endDate}
        </if>
    </select>

<!--    根据订单id查询采购订单-->
    <select id="getPurchaseOrderByOrderId" resultType="org.hzero.service.domain.entity.PurchaseOrder">
        SELECT
            pur_order.purchase_order_id,
            pur_order.purchase_order_number,
            pur_order.supplier_id,
            pur_order.purchase_order_date,
            pur_order.purchase_id,
            pur_order.currency_id,
            pur_order.purchase_order_sum_price,
            pur_order.purchase_order_state
        FROM
            `hff_purchase_order` pur_order
        WHERE
            pur_order.organization_id = #{tenantId}
        AND pur_order.purchase_order_id = #{purchaseOrderId}
    </select>
</mapper>